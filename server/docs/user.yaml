openapi: 3.0.0
info:
  title: User API
  version: 1.0.0
  description: API for managing users

servers:
  - url: http://localhost:3030
    description: Development server

paths:
  /users/{username}:
    get:
      tags:
        - Users
      summary: Get user profile by username
      description: Returns the public profile of a user. When authenticated, also includes relationship information (isFollowing, followsYou).
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
            minLength: 3
            maxLength: 30
          description: Username of the user to retrieve
          example: "johndoe"
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserProfileResponse'
        '403':
          description: User is blocked or has blocked you
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                blocked:
                  summary: User blocked
                  value:
                    success: false
                    message: "Access to this profile is restricted"
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_found:
                  summary: User does not exist
                  value:
                    success: false
                    message: "User not found"
        '500':
          $ref: '#/components/responses/ServerError'

  /users/profile:
    put:
      tags:
        - Users
      summary: Update own profile
      description: Allows authenticated user to update their profile information. Only provided fields will be updated.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fullName:
                  type: string
                  minLength: 2
                  maxLength: 50
                  example: "John Smith"
                bio:
                  type: string
                  maxLength: 300
                  example: "Full-stack developer passionate about open source"
                specialization:
                  type: string
                  maxLength: 100
                  example: "React & Node.js Developer"
                location:
                  type: string
                  maxLength: 100
                  example: "San Francisco, CA"
                profilePicture:
                  type: string
                  format: uri
                  example: "https://example.com/profile.jpg"
                coverImage:
                  type: string
                  format: uri
                  example: "https://example.com/cover.jpg"
            examples:
              update_bio:
                summary: Update bio and specialization
                value:
                  bio: "Senior software engineer with 5 years of experience"
                  specialization: "Backend Architecture"
              update_full_profile:
                summary: Update multiple fields
                value:
                  fullName: "John Smith"
                  bio: "Tech enthusiast and coffee lover"
                  specialization: "DevOps Engineer"
                  location: "New York, NY"
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Profile updated successfully"
                  data:
                    $ref: '#/components/schemas/UserProfileResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                validation_error:
                  summary: Invalid field values
                  value:
                    success: false
                    message: "Validation failed"
                    errors:
                      fullName: "Full name must be between 2 and 50 characters"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/ServerError'

components:
  schemas:
    UserProfileResponse:
      type: object
      description: User profile response for Epic 2 endpoints
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        username:
          type: string
          example: "johndoe"
        fullName:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        bio:
          type: string
          nullable: true
          example: "Software engineer passionate about clean code"
        specialization:
          type: string
          nullable: true
          example: "Frontend Development"
        location:
          type: string
          nullable: true
          example: "San Francisco, CA"
        profilePicture:
          type: string
          nullable: true
          example: "https://example.com/profile.jpg"
        coverImage:
          type: string
          nullable: true
          example: "https://example.com/cover.jpg"
        followersCount:
          type: integer
          example: 150
        followingCount:
          type: integer
          example: 200
        postsCount:
          type: integer
          example: 42
        createdAt:
          type: string
          format: date-time
          example: "2025-01-15T10:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-12-13T10:00:00.000Z"
        isFollowing:
          type: boolean
          description: Present only when request is authenticated. Indicates if the current user follows this profile.
          example: true
        followsYou:
          type: boolean
          description: Present only when request is authenticated. Indicates if this profile follows the current user.
          example: false

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Error message"

  responses:
    UnauthorizedError:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "NO_TOKEN"
                  message:
                    type: string
                    example: "Authentication required"

    ServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Internal server error"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/register or /auth/login

tags:
  - name: Users
    description: User management operations
